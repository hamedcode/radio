<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø±Ø§Ø¯ÛŒÙˆ Ø¢Ù†Ù„Ø§ÛŒÙ†</title>

<style>
:root{
  --bg:#121212;
  --card:#1d1d1d;
  --accent:#00ffa6;
  --text:#eee;
  --header:#151515;
  --muted:rgba(255,255,255,0.06);
}

/* light theme vars (will be applied via [data-theme="light"]) */
:root[data-theme="light"]{
  --bg:#e3f4ff;     
  --card:#f0f9ff;    
  --header:#ffffff;
  --text:#0b1220;
  --muted:rgba(0,0,0,0.08);
  --station-border: 1px solid rgba(0,0,0,0.12); /* Ø­Ø§Ø´ÛŒÙ‡ Ù…Ø´Ú©ÛŒ Ù…Ù„Ø§ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ù‡Ø± Ú©Ø§Ù†Ø§Ù„ */
}

/* defaults */
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto;
  direction:rtl;
  background:var(--bg);
  color:var(--text);
}

/* ===== TOP BAR ===== */
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 16px;
  background:var(--header);
  border-bottom:1px solid var(--muted);
  position:sticky;
  top:0;
  z-index:1500;
}
.title{font-size:20px}

/* iOS switch */
.switch {
  width:56px; height:26px;
  border-radius:50px;
  background:#555;
  position:relative;
  cursor:pointer;
  transition:.25s;
  display:flex;
  align-items:center;
  padding:0 6px;
}

.switch-icon {
  font-size:14px;
  color:white;
  pointer-events:none;
  transition:.25s;
  position:absolute;
  left:8px;
}

.switch.on .switch-icon {
  left:auto;
  right:8px;
}
.switch.on{background:#fff}
.switch.on .switch-circle{left:24px}

/* Color picker */
.color-picker{display:flex;gap:8px}
.color-swatch{
  width:22px;height:22px;
  border-radius:50%;
  cursor:pointer;
  border:2px solid rgba(255,255,255,0.1);
}
.color-swatch.selected{
  outline:2px solid #fff;
  transform:scale(1.08);
}

/* ===== CHANNEL LIST ===== */
.cols{
  display:flex;
  gap:18px;
  padding:16px;
  max-width:1100px;
  margin:12px auto 170px auto;
}
.col{flex:1}

.category{
  background:var(--card);
  padding:10px 14px;
  border-radius:8px;
  margin-bottom:12px;
  font-size:18px;
  border:1px solid transparent;
}

/* station list */
.station-list{
  display:flex;
  flex-direction:column;
  gap:10px;
}

.station{
  background:var(--card);
  border-radius:10px;
  padding:10px;
  display:flex;
  justify-content:space-between;
  cursor:pointer;
  align-items:center;
  transition:.12s;
  /* border in light theme applied via CSS variable */
  border: var(--station-border, 0);
}
.station:hover{transform:translateY(-2px); box-shadow:0 6px 18px rgba(0,0,0,0.18)}
.left{display:flex;align-items:center;gap:12px}
.station img{
  width:44px;height:44px;
  border-radius:6px;
  object-fit:cover;
  background:rgba(0,0,0,0.06);
}
.name{font-weight:600;max-width:240px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

.station button{
  background:var(--accent);
  border:none;
  padding:8px 10px;
  border-radius:8px;
  min-width:60px;
  text-align:center;
  cursor:pointer;
  color:#000;
  transition:transform .08s;
}
.station button:active{ transform:scale(.98) }

/* ===== PLAYER ===== */
.player-box{
  position:fixed;
  bottom:0;left:0;right:0;
  padding:12px;
  background:var(--card);
  border-top:3px solid var(--accent);
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:2000;
  box-shadow:0 -6px 25px rgba(0,0,0,0.6);
}

#eq{
  width:100%;height:60px;
  background:#000;border-radius:6px;
}

.player-controls{
  display:flex;
  gap:12px;
  align-items:center;
}
.player-title{
  flex:1;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  font-weight:600;
}

@media(max-width:900px){
  .cols{flex-direction:column;margin-bottom:230px}
  #eq{height:45px}
}
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="title">ğŸ§ Ø±Ø§Ø¯ÛŒÙˆ Ø¢Ù†Ù„Ø§ÛŒÙ†</div>

  <div style="display:flex;align-items:center;gap:14px">
    <div id="themeSwitch" class="switch" title="ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª">
      <div class="switch-icon">ğŸŒ™</div>
      <div class="switch-circle"></div>
    </div>

    <div class="color-picker" id="colorPicker" title="ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ ØªÙ…">
      <div class="color-swatch selected" data-color="#00ffa6" style="background:#00ffa6"></div>
      <div class="color-swatch" data-color="#00aaff" style="background:#00aaff"></div>
      <div class="color-swatch" data-color="#ffcc00" style="background:#ffcc00"></div>
      <div class="color-swatch" data-color="#ff4444" style="background:#ff4444"></div>
      <div class="color-swatch" data-color="#c95bff" style="background:#c95bff"></div>
    </div>
  </div>
</div>

<!-- CHANNEL LIST -->
<div class="cols">
  <div class="col">
    <div class="category">ğŸ“Œ ØªØ±Ú©ÛŒ Ùˆ Ø¢Ø°Ø±ÛŒ</div>
    <div class="station-list" id="cat_tr"></div>
  </div>

  <div class="col">
    <div class="category">ğŸ“Œ ÙØ§Ø±Ø³ÛŒ</div>
    <div class="station-list" id="cat_fa"></div>
  </div>
</div>

<!-- PLAYER -->
<div class="player-box">
  <canvas id="eq" aria-hidden="true"></canvas>

  <div class="player-controls">
    <div class="player-title" id="nowPlaying">Ù‡ÛŒÚ† Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡</div>

    <label style="display:flex;align-items:center;gap:8px">Ø­Ø¬Ù…:
      <input id="volume" type="range" min="0" max="1" value="1" step="0.01" style="width:140px">
    </label>

    <button id="stopBtn">â¹ ØªÙˆÙ‚Ù</button>
  </div>
</div>

<!-- HLS.JS -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
/* ====================== */
/*      CHANNEL DATA      */
/*  (Ø´Ø§Ù…Ù„ Ù†Ø§Ù…ØŒ Ù„ÛŒÙ†Ú© Ù¾Ø®Ø´ Ùˆ Ù„ÙˆÚ¯Ùˆ) */
/* ====================== */

const channelsTR = [
  { name:"Arabesk Efsane FM",
    url:"https://stream.zeno.fm/x5n4sfyy9nhvv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Arabesk_Efsane_FM.webp"
  },
  { name:"Radio Veten",
    url:"https://stream.zeno.fm/0kgkkzanmueuv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/radio_veten.png"
  },
  { name:"Ä°ZNÄ°K FM",
    url:"https://stream.zeno.fm/4crdx4nukrnuv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/%C4%B0ZN%C4%B0K_FM.webp"
  },
  { name:"Radyo Nostaljinin Sesi",
    url:"https://stream.zeno.fm/q7zxyx2qsfhvv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radyo_Nostaljinin_Sesi.webp"
  },
  { name:"Arabeskin MerkazÄ°",
    url:"https://canli.arabeskinmerkezi.com/9180/stream",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio.webp"
  },
  { name:"Azad AzÉ™rbaycan radiosu",
    url:"https://radio.fnvm.workers.dev/?url=https%3A%2F%2Faudiostr.atv.az%2F106.3fm",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio.webp"
  },
  { name:"Yurd FM",
    url:"https://radio.fnvm.workers.dev/?url=https%3A%2F%2Ficecast.livetv.az%2Fyurdfm",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio.webp"
  },
  { name:"ARAS RADIO",
    url:"https://stream.zeno.fm/dkq2vwpuqf0uv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/ARAS_RADIO.webp"
  },
  { name:"Arabesk ON7",
    url:"https://stream.zeno.fm/kd3h0p1qcphvv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Arabesk_ON7.webp"
  },
  { name:"Karaviran FM",
    url:"https://stream.zeno.fm/wfd8v2rsywzuv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Karaviran_FM.webp"
  },
  { name:"NaxÃ§Ä±van Radiosu",
    url:"http://s33.myradiostream.com:12782/listen.mp3",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Nax%C3%A7%C4%B1van%20Radiosu.webp"
  }
];


const channelsFA = [
  { name:"Radio Hamrah",
    url:"https://stream.zeno.fm/euutwhsru2wtv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio_Hamrah.webp"
  },
  { name:"Radio Yar",
    url:"https://stream.zeno.fm/oyb5oh6ne3tuv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio_Yar.webp"
  },
  { name:"KIRN 670",
    url:"https://stream.zeno.fm/16gxgv7ch5zuv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/KIRN%20670.webp"
  },
  { name:"RADIO SIMORGH music",
    url:"https://stream.zeno.fm/9svfnobkrxrvv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/radio_simorgh1.jpg"
  },
  
  { name:"RADIO SIMORGH",
    url:"https://stream.zeno.fm/jl8n7thgcdftv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/radio_simorgh2.jpg"
  },
  { name:"Radio Yar Plus",
    url:"https://stream.zeno.fm/2jwyo983y49vv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio_Yar_Plus.webp"
  },
  { name:"Radio Avang Club",
    url:"https://stream.zeno.fm/fpabqr8pd9zuv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio_Avang_Club.webp"
  },
  { name:"Radio Farsi London",
    url:"https://stream.zeno.fm/c3kkavhhzd0uv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio_Farsi_London.webp"
  },
  { name:"Radio Darbast",
    url:"https://live.radiodarbast.com/stream.mp3",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio_Darbast.webp"
  },
  { name:"Radio Arina",
    url:"https://s5.voscast.com:10205/stream",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio_Arina.jpg"
  },
  { name:"Radio Khatereh",
    url:"https://s-us1.srv-control.com:5727/stream?tag=rk6qr",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio_Khatereh.png"
  },
  { name:"Radio Sarcheshmeh",
    url:"https://sarcheshmeh.awsvps.com/stream",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio_Sarcheshmeh.png"
  },
  { name:"Radio JiBi",
    url:"https://stream.radiojar.com/pk8rnhvtuy8uv",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio_JiBi.png"
  },
  { name:"Radio Salmak",
    url:"https://stream.radiojar.com/atdbyqwr8vuvv",
    logo:"https://www.sedaye-iran.online/assets/images/emblems/radio_salmak.png"
  },
  { name:"Radio AVA Istanbul",
    url:"https://play.markaradyo.com:8002/stream",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio_AVA_Istanbul.webp"
  },
  { name:"Radio Iran IRIB",
    url:"https://s2.cdn1.iranseda.ir/liveedge/radio-iran/playlist.m3u8",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/radio_iran_irib.webp"
  },
  
  { name:"Radio Javan IRIB",
    url:"https://s6.cdn3.iranseda.ir/liveedge/radio-javan/playlist.m3u8",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/radio-javan.jpg"
  },
  
  { name:"Radio AVA IRIB",
    url:"https://s0.cdn1.iranseda.ir/liveedge/radio-avaa/playlist.m3u8",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/radio_ava_irib.webp"
  },
  
  { name:"Radio Payam IRIB",
    url:"https://s1.cdn3.iranseda.ir/liveedge/radio-payam/playlist.m3u8",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/radio_payam_irib.webp"
  },
  
  { name:"Radio Varzesh IRIB",
    url:"https://s0.cdn1.iranseda.ir/liveedge/radio-varzesh/playlist.m3u8",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/radio_varzesh_irib.webp"
  },
  
  { name:"Radio Shadi",
    url:"https://ice9.securenetsystems.net/SHADI",
    logo:"https://raw.githubusercontent.com/hamedcode/radio/refs/heads/main/Logo/Radio_Shadi.webp"
  }
];

/* =========================
   UI / List rendering
   ========================= */
function createList(list, target){
  target.innerHTML = "";
  list.forEach(ch=>{
    const id = "btn_" + ch.name.replace(/\s+/g,"_").replace(/[^\w\-]/g,"");
    const el = document.createElement("div");
    el.className="station";

    el.innerHTML = `
      <div class="left">
        <img src="${ch.logo}" referrerpolicy="no-referrer" alt="${ch.name} logo">
        <div class="name">${ch.name}</div>
      </div>
      <button id="${id}">â–¶ Ù¾Ø®Ø´</button>
    `;

    el.querySelector("button").onclick = ()=> toggleChannel(ch);
    target.appendChild(el);
  });
}

createList(channelsTR, document.getElementById("cat_tr"));
createList(channelsFA, document.getElementById("cat_fa"));

/* ==================================== */
/*          AUDIO + EQ ENGINE           */
/* ==================================== */

let audio = new Audio();
audio.crossOrigin = "anonymous";

let audioCtx = null;
let analyser = null;
let sourceNode = null;
let dataArray = null;
let userGesture = false;

function ensureAudioContext(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 128;
    dataArray = new Uint8Array(analyser.frequencyBinCount);
    sourceNode = audioCtx.createMediaElementSource(audio);
    sourceNode.connect(analyser);
    analyser.connect(audioCtx.destination);
  }
}

/* Fix Chrome autoplay restriction */
document.addEventListener("click", ()=>{
  userGesture = true;
  ensureAudioContext();
  if(audioCtx && audioCtx.state === "suspended"){
    audioCtx.resume();
  }
}, {once:true});


/* ==================================== */
/*        PLAYER CONTROL LOGIC          */
/* ==================================== */

let currentChannel = null;

function updateButtons(){
  document.querySelectorAll(".station button").forEach(btn=>{
    btn.innerText = "â–¶ Ù¾Ø®Ø´";
  });

  if(currentChannel){
    const id = "btn_" + currentChannel.name.replace(/\s+/g,"_").replace(/[^\w\-]/g,"");
    const btn = document.getElementById(id);
    if(btn) btn.innerText = "â¹ ØªÙˆÙ‚Ù";
  }
}

/* ============ M3U8 + toggleChannel ============ */

function toggleChannel(ch){
  if(!userGesture) ensureAudioContext();

  // Ø§Ú¯Ø± Ù‡Ù…Ø§Ù† Ú©Ø§Ù†Ø§Ù„ Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´ Ø§Ø³Øª -> Ù…ØªÙˆÙ‚ÙØ´ Ú©Ù†
  if(currentChannel && currentChannel.url === ch.url && !audio.paused){
    audio.pause();
    audio.src = "";
    currentChannel = null;
    if(window.hls){ window.hls.destroy(); window.hls = null; }
    document.getElementById("nowPlaying").innerText = "Ù‡ÛŒÚ† Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡";
    updateButtons();
    return;
  }

  currentChannel = ch;

  // Ø§Ú¯Ø± Ù„ÛŒÙ†Ú© m3u8 Ø§Ø³Øª Ùˆ hls.js Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
  try {
    const isM3U8 = typeof ch.url === "string" && ch.url.toLowerCase().includes(".m3u8");
    if (window.Hls && Hls.isSupported() && isM3U8) {
      if(window.hls){ window.hls.destroy(); window.hls = null; }
      window.hls = new Hls();
      window.hls.loadSource(ch.url);
      window.hls.attachMedia(audio);
      window.hls.on(Hls.Events.MANIFEST_PARSED, ()=> {
        // resume audio context if needed
        if(audioCtx && audioCtx.state === "suspended") audioCtx.resume();
        audio.play().catch(e=>console.log("play error hls:", e));
      });
    } else {
      // fallback: Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ audio.src
      if(window.hls){ window.hls.destroy(); window.hls = null; }
      audio.src = ch.url;
      if(audioCtx && audioCtx.state === "suspended") audioCtx.resume();
      audio.play().catch(e=>console.log("play error src:", e));
    }
  } catch(err){
    console.log("toggleChannel error:", err);
    // fallback safe
    try{ audio.src = ch.url; audio.play().catch(()=>{}); }catch(e){}
  }

  document.getElementById("nowPlaying").innerText = ch.name;
  updateButtons();
}

/* Stop button */
document.getElementById("stopBtn").onclick = ()=>{
  audio.pause();
  audio.src = "";
  currentChannel = null;
  if(window.hls){ window.hls.destroy(); window.hls = null; }
  document.getElementById("nowPlaying").innerText = "Ù‡ÛŒÚ† Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡";
  updateButtons();
};

/* Volume */
document.getElementById("volume").oninput = e=>{
  audio.volume = e.target.value;
};

/* ==================================== */
/*            EQUALIZER DRAW            */
/* ==================================== */

const canvas = document.getElementById("eq");
const ctx = canvas.getContext("2d");

function resizeEQ(){
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
}
resizeEQ();
window.addEventListener("resize", resizeEQ);

function drawEQ(){
  requestAnimationFrame(drawEQ);
  if(!analyser) return;

  analyser.getByteFrequencyData(dataArray);

  ctx.fillStyle = "#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  const barWidth = canvas.width / dataArray.length;
  for(let i=0;i<dataArray.length;i++){
    const v = dataArray[i];
    const barHeight = (v / 255) * canvas.height;

    ctx.fillStyle = getComputedStyle(document.documentElement)
      .getPropertyValue("--accent");
    ctx.fillRect(i*barWidth, canvas.height-barHeight, barWidth-1, barHeight);
  }
}
drawEQ();

/* ==================================== */
/*          THEME + COLOR PICKER        */
/* ==================================== */

const switchEl = document.getElementById("themeSwitch");

function setDarkMode(on){
  switchEl.classList.toggle("on", on);
  document.querySelector(".switch-icon").textContent = on ? "ğŸŒ™" : "â˜€ï¸";
  // set data-theme on root so CSS can react (e.g. station border)
  document.documentElement.setAttribute("data-theme", on ? "dark" : "light");

  if(on){
    document.documentElement.style.setProperty("--bg", "#121212");
    document.documentElement.style.setProperty("--card", "#1d1d1d");
    document.documentElement.style.setProperty("--header", "#151515");
    document.documentElement.style.setProperty("--text", "#eee");
    document.documentElement.style.setProperty("--muted","rgba(255,255,255,0.06)");
    document.documentElement.style.setProperty("--station-border","0");
  } else {
    // light (not too white)
    document.documentElement.style.setProperty("--bg", "#e3f4ff");
    document.documentElement.style.setProperty("--card", "#f0f9ff");
    document.documentElement.style.setProperty("--header", "#ffffff");
    document.documentElement.style.setProperty("--text", "#0b1220");
    document.documentElement.style.setProperty("--muted","rgba(0,0,0,0.08)");
    // add subtle black border for stations
    document.documentElement.style.setProperty("--station-border","1px solid rgba(0,0,0,0.12)");
  }
}

switchEl.onclick = ()=>{
  const isOn = !switchEl.classList.contains("on");
  setDarkMode(isOn);
};

/* Default = Dark */
setDarkMode(true);

/* Accent color picker */
document.querySelectorAll(".color-swatch").forEach(sw=>{
  sw.onclick = ()=>{
    document.querySelectorAll(".color-swatch").forEach(s=>s.classList.remove("selected"));
    sw.classList.add("selected");
    const col = sw.dataset.color;
    document.documentElement.style.setProperty("--accent", col);
    // update player border color too
    document.querySelectorAll(".player-box, .station button").forEach(el=>{
      // no direct color change needed because CSS reads --accent; kept for completeness
    });
  };
});
</script>
</body>
</html>
