<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Radio Player v1.2</title>

<style>
body{
  margin:0;
  background:#111;
  font-family:sans-serif;
  color:#fff;
  transition:background 0.4s, color 0.3s;
}

/* Light mode */
body.light{
  background:#e7e7e7;
  color:#222;
}

/* Header */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 15px;
  background:#222;
  border-bottom:1px solid #333;
  position:sticky;
  top:0;
  z-index:20;
}
body.light header{
  background:#f5f5f5;
  border-bottom:1px solid #ccc;
}

/* iOS switch */
.switch{
  position:relative;
  width:45px;
  height:24px;
}
.switch input{
  opacity:0; width:0; height:0;
}
.slider{
  position:absolute;
  cursor:pointer;
  top:0; left:0;
  right:0; bottom:0;
  background:#555;
  border-radius:24px;
  transition:0.3s;
}
.slider:before{
  position:absolute;
  content:\"\"; 
  height:18px; width:18px;
  left:3px; top:3px;
  background:white;
  border-radius:50%;
  transition:0.3s;
}
input:checked + .slider{
  background:#0f8;
}
input:checked + .slider:before{
  transform:translateX(21px);
}

/* Theme color dots */
#colorBox{
  display:flex;
  gap:8px;
}
.colorDot{
  width:18px;
  height:18px;
  border-radius:50%;
  cursor:pointer;
  border:2px solid #0003;
}

/* Channel grid */
#channels{
  padding:15px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:12px;
}
.channelBox{
  padding:10px;
  border-radius:12px;
  background:#1d1d1d;
  text-align:center;
  transition:background 0.3s;
}
body.light .channelBox{
  background:#f1f1f1;
}
.channelBox img{
  width:100%;
  border-radius:10px;
}
.playBtn{
  margin-top:8px;
  padding:6px 12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-size:14px;
  background:var(--themeColor);
  color:#000;
}

/* Footer player */
#playerBar{
  position:fixed;
  bottom:0; left:0; right:0;
  background:#000;
  padding:10px;
  display:flex;
  gap:12px;
  align-items:center;
  border-top:1px solid #333;
}
body.light #playerBar{
  background:#fafafa;
  border-top:1px solid #ccc;
}

/* Equalizer */
#eq {
  height:40px;
  flex:1;
  display:flex;
  align-items:flex-end;
  gap:2px;
}
.eqBar{
  width:6px;
  background:var(--themeColor);
  height:10px;
  transition:height 0.1s linear;
}

/* Default theme color */
:root{
  --themeColor:#00ff88;
}
</style>

</head>
<body>

<header>
  <label class="switch">
    <input id="modeSwitch" type="checkbox" checked>
    <span class="slider"></span>
  </label>

  <div id="colorBox">
    <div class="colorDot" style="background:#00ff88" data-col="#00ff88"></div>
    <div class="colorDot" style="background:#ffdd00" data-col="#ffdd00"></div>
    <div class="colorDot" style="background:#ff4444" data-col="#ff4444"></div>
    <div class="colorDot" style="background:#33a0ff" data-col="#33a0ff"></div>
  </div>
</header>

<div id="channels"></div>

<!-- Bottom Player -->
<div id="playerBar">
  <button id="mainPlay" class="playBtn">⏸ توقف</button>
  <div id="nowPlaying" style="width:180px; font-size:14px;">…</div>
  <div id="eq"></div>
</div>

<audio id="player"></audio>

<script>
// ===============================
//      CHANNEL LIST
// ===============================
const channels = [
  { name:"Radio Hamrah", url:"https://stream.zeno.fm/euutwhsru2wtv", logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/QXH8sr3xE8WGEbYBpaNlPpoAuEMKqcEoFDAZOS_fixI/rs:fill:256:256/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvYWd4emZucGxibTh0YzNSaGRITnlHd3NTRGxOMFlYUnBiMjVRY205bWFXeGxHSUNBZ0lEUDd0b0tES0lCQkhwbGJtOC9pbWFnZS8_dT0xNjcyMzAxMjY3MDAw.webp"},
  { name:"Radio Yar", url:"https://stream.zeno.fm/oyb5oh6ne3tuv", logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/kw4YYJRvsl-DswchOsWr3Vtz1MnLY8gfkPAf_FSMgyo/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvMWRjZmJjMzktYzM4NS00OTg3LWE5ZTQtYTFiMjE0NDAzZDg3L2ltYWdlLz91PTE3MjgzOTk2MzcwMDA.webp"},
  { name:"Radio Shadi", url:"https://ice9.securenetsystems.net/SHADI", logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/NRIGBcOzqWFUZZ4dhVZ3bp6oKMftJTpniyrmgru7dZM/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvOGUyZDcwMjUtMmZhMC00MDU5LWFmNGMtMDg0ZjA1NmZjOTk4L2ltYWdlLz91PTE3MDE2OTc1OTEwMDA.webp"}
];

// ===============================
//  RENDER CHANNEL GRID
// ===============================
const chBox = document.getElementById("channels");
chBox.innerHTML = channels.map((c,i)=>`
  <div class="channelBox" id="ch${i}">
    <img src="${c.logo}">
    <div style="margin-top:6px">${c.name}</div>
    <button class="playBtn" onclick="toggleChannel(${i})" id="btn${i}">▶ پخش</button>
  </div>
`).join("");

// ===============================
//      AUDIO ENGINE FIX
// ===============================
const audio = document.getElementById("player");
let ctx, src, analyser;
let currentIndex = -1;

function initAudio(){
  if(!ctx){
    ctx = new (window.AudioContext||window.webkitAudioContext)();
    src = ctx.createMediaElementSource(audio);
    analyser = ctx.createAnalyser();
    analyser.fftSize = 256;
    analyser.smoothingTimeConstant = 0.5;

    src.connect(analyser);
    analyser.connect(ctx.destination);
  }
  if(ctx.state === "suspended") ctx.resume();
}

document.body.addEventListener("touchstart", ()=>initAudio(), {once:true});

// ===============================
//     PLAY / STOP FROM CARD
// ===============================
function toggleChannel(i){
  initAudio();

  if(currentIndex === i){
    stopRadio();
    return;
  }

  playRadio(i);
}

function playRadio(i){
  currentIndex = i;
  audio.src = channels[i].url;
  audio.play().catch(e=>console.log(e));

  document.getElementById("nowPlaying").textContent = channels[i].name;

  document.querySelectorAll(".playBtn").forEach(btn=>btn.textContent="▶ پخش");
  document.getElementById("btn"+i).textContent="⏸ توقف";

  document.getElementById("mainPlay").textContent="⏸ توقف";
}

function stopRadio(){
  audio.pause();
  audio.src="";
  currentIndex = -1;

  document.querySelectorAll(".playBtn").forEach(btn=>btn.textContent="▶ پخش");
  document.getElementById("nowPlaying").textContent="…";
  document.getElementById("mainPlay").textContent="▶ پخش";
}

// ===============================
//      MAIN PLAYER BUTTON
// ===============================
document.getElementById("mainPlay").onclick = ()=>{
  if(currentIndex === -1) return;
  stopRadio();
};

// ===============================
//         EQUALIZER
// ===============================
const eq = document.getElementById("eq");
for(let i=0;i<20;i++){
  let b = document.createElement("div");
  b.className="eqBar";
  eq.appendChild(b);
}
const bars = document.querySelectorAll(".eqBar");

function drawEq(){
  if(analyser){
    let data = new Uint8Array(analyser.frequencyBinCount);
    analyser.getByteFrequencyData(data);

    for(let i=0;i<bars.length;i++){
      let v = data[i*2] || 0;
      let h = Math.max(5, v/3);
      bars[i].style.height = h+"px";
    }
  }
  requestAnimationFrame(drawEq);
}
drawEq();

// ===============================
//        MODE SWITCH
// ===============================
document.getElementById("modeSwitch").onchange = e=>{
  if(e.target.checked) document.body.classList.remove("light");
  else document.body.classList.add("light");
};

// ===============================
//      COLOR THEME SWITCH
// ===============================
document.querySelectorAll(".colorDot").forEach(d=>{
  d.onclick = ()=>{
    let c = d.dataset.col;
    document.documentElement.style.setProperty("--themeColor", c);
  };
});
</script>

</body>
</html>
