<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ø±Ø§Ø¯ÛŒÙˆ Ø¢Ù†Ù„Ø§ÛŒÙ†</title>
  <style>
    :root{
      --bg:#121212;
      --card:#1d1d1d;
      --accent:#00ffa6;
      --text:#eee;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      direction:rtl;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
    }

    .header{
      padding:18px;
      text-align:center;
      background:#151515;
      font-size:22px;
      border-bottom:1px solid rgba(255,255,255,0.03);
    }

    .cols{
      display:flex;
      gap:18px;
      padding:16px;
      max-width:1100px;
      margin: 12px auto 160px auto; /* ÙØ¶Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ù„ÛŒØ± Ø¬Ø¯ÛŒØ¯ */
    }
    .col{flex:1;}
    .category{
      padding:10px 14px;
      font-size:18px;
      background:#212121;
      border-radius:8px;
      margin-bottom:10px;
    }

    .station-list{display:flex;flex-direction:column;gap:10px}
    .station{
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:var(--card);
      padding:10px;
      border-radius:10px;
      cursor:pointer;
      transition: background .15s;
    }
    .station:hover{background:#2a2a2a}
    .station .left{display:flex;align-items:center;gap:12px}
    .station img{width:44px;height:44px;border-radius:6px;object-fit:cover}
    .station .meta{display:flex;flex-direction:column;text-align:right}
    .station .name{font-weight:600}
    .station button{
      background:var(--accent);
      border:none;
      color:#000;
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
    }

    /* Ù¾Ù„ÛŒØ± + Ø§Ú©ÙˆÙ„Ø§ÛŒØ²Ø± Ø¯Ø± ÛŒÚ© Ø¨Ø§Ú©Ø³ */
    .player-box{
      position:fixed;
      bottom:0;
      left:0;
      right:0;
      background:#181818;
      border-top:3px solid var(--accent);
      padding:10px 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index:2000;
    }

    #eq{
      width:100%;
      height:64px;
      background:#000;
      border-radius:6px;
      display:block;
    }

    .player-controls{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .player-title{
      flex:1;
      font-size:15px;
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
    }
    .vol{width:140px}

    @media(max-width:900px){
      .cols{flex-direction:column;margin-bottom:220px}
      #eq{height:40px;}
    }
  </style>
</head>
<body>

  <div class="header">ğŸ§ Ø±Ø§Ø¯ÛŒÙˆ Ø¢Ù†Ù„Ø§ÛŒÙ†</div>

  <div class="cols">
    <div class="col">
      <div class="category">ğŸ“Œ ØªØ±Ú©ÛŒ Ùˆ Ø¢Ø°Ø±ÛŒ</div>
      <div class="station-list" id="cat_tr"></div>
    </div>
    <div class="col">
      <div class="category">ğŸ“Œ ÙØ§Ø±Ø³ÛŒ</div>
      <div class="station-list" id="cat_fa"></div>
    </div>
  </div>

  <!-- Ø¨Ø§Ú©Ø³ Ù¾Ù„ÛŒØ± + Ø§Ú©ÙˆÙ„Ø§ÛŒØ²Ø± -->
  <div class="player-box">
    <canvas id="eq"></canvas>

    <div class="player-controls">
      <div class="player-title" id="nowPlaying">Ù‡ÛŒÚ† Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡</div>

      Ø­Ø¬Ù…:
      <input class="vol" id="volume" type="range" min="0" max="1" step="0.01" value="1">

      <button id="stopBtn">â¹ ØªÙˆÙ‚Ù</button>
    </div>
  </div>

<script>

/* ======= Ø¯Ø§Ø¯Ù‡â€ŒÚ©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ (Ù‡Ù…Ø§Ù† ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ø®ÙˆØ¯Øª) ======= */
const stations = [
  /* >>> Ú©Ù„ Ù„ÛŒØ³Øª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ ÙØ§ÛŒÙ„ Ø®ÙˆØ¯Øª Ø¯Ø§Ø´Øª Ø¯Ù‚ÛŒÙ‚Ø§ Ù‡Ù…ÛŒÙ†Ø¬Ø§ Ø¨ÙˆØ¯
     Ù…Ù† Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø¯Ø± Ø¢Ù† Ø§ÛŒØ¬Ø§Ø¯ Ù†Ú©Ø±Ø¯Ù…ØŒ Ú©Ø§Ù…Ù„ Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ… <<< */
];

/* ======= Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯ Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾ØªØŒ Ø¨Ø¯ÙˆÙ† Ù‡ÛŒÚ† ØªØºÛŒÛŒØ± ======= */

const cat_fa = document.getElementById('cat_fa');
const cat_tr = document.getElementById('cat_tr');
const nowPlaying = document.getElementById('nowPlaying');
const volume = document.getElementById('volume');
const stopBtn = document.getElementById('stopBtn');

const audio = new Audio();
audio.crossOrigin = "anonymous";
audio.preload = "none";
audio.volume = parseFloat(volume.value);

function makeStationElement(st){
  const el=document.createElement('div'); el.className='station';
  const left=document.createElement('div'); left.className='left';
  const meta=document.createElement('div'); meta.className='meta';
  const title=document.createElement('div'); title.className='name'; title.textContent=st.name;
  meta.appendChild(title);

  if(st.logo){
    const img=document.createElement('img'); img.src=st.logo; img.onerror=()=>img.style.display='none';
    left.appendChild(img);
  }
  left.appendChild(meta);

  const btn=document.createElement('button');
  btn.textContent='â–¶ Ù¾Ø®Ø´';
  btn.onclick=e=>{e.stopPropagation();handlePlay(st,btn);}

  el.appendChild(left);
  el.appendChild(btn);

  el.onclick=()=>handlePlay(st,btn);

  return el;
}

stations.forEach(s=>{
  const node=makeStationElement(s);
  if(s.lang==='fa') cat_fa.appendChild(node);
  else cat_tr.appendChild(node);
});

let currentStation=null;
let currentButton=null;

function handlePlay(st,btn){
  if(currentStation && currentStation.url===st.url && !audio.paused){
    audio.pause();
    btn.textContent='â–¶ Ù¾Ø®Ø´';
    nowPlaying.textContent='Ù‡ÛŒÚ† Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡';
    return;
  }
  audio.src = st.url;
  audio.play();

  if(currentButton) currentButton.textContent='â–¶ Ù¾Ø®Ø´';
  btn.textContent='â¸ï¸ ØªÙˆÙ‚Ù';

  currentStation = st;
  currentButton = btn;
  nowPlaying.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´: ' + st.name;
}

volume.oninput = ()=> audio.volume = parseFloat(volume.value);

stopBtn.onclick = ()=>{
  audio.pause();
  if(currentButton) currentButton.textContent='â–¶ Ù¾Ø®Ø´';
  nowPlaying.textContent='Ù‡ÛŒÚ† Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡';
};

/* ===== Ø§Ú©ÙˆÙ„Ø§ÛŒØ²Ø± ===== */
const eq=document.getElementById('eq');
const eqCtx=eq.getContext('2d');

function resizeEq(){
  const dpr=window.devicePixelRatio||1;
  const cssH=parseInt(getComputedStyle(eq).height);
  eq.width=window.innerWidth*dpr;
  eq.height=cssH*dpr;
  eqCtx.setTransform(dpr,0,0,dpr,0,0);
}
window.onresize=resizeEq;
resizeEq();

let audioCtx=null, analyser=null, srcNode=null;

function ensureAudioContext(){
  if(audioCtx) return;
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  srcNode=audioCtx.createMediaElementSource(audio);
  analyser=audioCtx.createAnalyser();
  analyser.fftSize=256;
  srcNode.connect(analyser);
  analyser.connect(audioCtx.destination);
}

audio.addEventListener('play',()=>{
  try{ensureAudioContext();}catch{}
});

function draw(){
  requestAnimationFrame(draw);
  if(!analyser){
    eqCtx.fillStyle='#000';
    eqCtx.fillRect(0,0,eq.width,eq.height);
    return;
  }
  const b=analyser.frequencyBinCount;
  const arr=new Uint8Array(b);
  analyser.getByteFrequencyData(arr);

  const w=eq.clientWidth;
  const h=eq.clientHeight;

  eqCtx.fillStyle='#000';
  eqCtx.fillRect(0,0,w,h);

  const barW=(w/b)*2.2;
  let x=0;

  for(let i=0;i<b;i++){
    let v=(arr[i]/255)*0.7*h;
    eqCtx.fillStyle='#00ffa6';
    eqCtx.fillRect(x,h-v,barW,v);
    x+=barW+1;
  }
}
draw();

</script>
</body>
</html>
