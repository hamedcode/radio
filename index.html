<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ø±Ø§Ø¯ÛŒÙˆ Ø¢Ù†Ù„Ø§ÛŒÙ†</title>
  <style>
    :root{
      --bg:#121212;
      --card:#1d1d1d;
      --accent:#00ffa6; /* default accent */
      --text:#eee;
      --header:#151515;
      --muted: rgba(255,255,255,0.06);
    }
    /* Light theme vars will be applied by JS when toggled */
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      direction:rtl;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 16px;
      background:var(--header);
      border-bottom:1px solid var(--muted);
      position:sticky;
      top:0;
      z-index:1500;
    }
    .title{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:20px;
    }

    /* controls area (toggle + color picker) */
    .controls{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .mode-btn{
      background:transparent;
      border:1px solid var(--muted);
      color:var(--text);
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .mode-btn.active{ border-color: var(--accent); box-shadow: 0 0 8px rgba(0,0,0,0.2); }

    .color-picker{
      display:flex;
      align-items:center;
      gap:8px;
      background:transparent;
      padding:6px;
      border-radius:10px;
    }
    .color-swatch{
      width:22px;
      height:22px;
      border-radius:50%;
      border:2px solid rgba(255,255,255,0.06);
      cursor:pointer;
      box-shadow: 0 1px 2px rgba(0,0,0,0.4);
      transition: transform .08s;
    }
    .color-swatch:active{ transform: scale(.92); }
    .color-swatch.selected{
      outline: 2px solid #fff;
      transform: scale(1.08);
    }

    .cols{
      display:flex;
      gap:18px;
      padding:16px;
      max-width:1100px;
      margin: 12px auto 170px auto;
    }
    .col{flex:1;}
    .category{
      padding:10px 14px;
      font-size:18px;
      background:var(--card);
      border-radius:8px;
      margin-bottom:10px;
    }

    .station-list{display:flex;flex-direction:column;gap:10px}
    .station{
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:var(--card);
      padding:10px;
      border-radius:10px;
      cursor:pointer;
      transition: background .15s;
      color:var(--text);
    }
    .station:hover{background:rgba(255,255,255,0.02)}
    .station .left{display:flex;align-items:center;gap:12px}
    .station img{width:44px;height:44px;border-radius:6px;object-fit:cover}
    .station .meta{display:flex;flex-direction:column;text-align:right}
    .station .name{font-weight:600}
    .station button{
      background:var(--accent);
      border:none;color:#000;padding:8px 10px;border-radius:8px;cursor:pointer;
    }

    /* Ù¾Ù„ÛŒØ± + Ø§Ú©ÙˆÙ„Ø§ÛŒØ²Ø± */
    .player-box{
      position:fixed;
      bottom:0;
      left:0;
      right:0;
      background:var(--card);
      border-top:3px solid var(--accent);
      padding:10px 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index:2000;
      box-shadow: 0 -6px 20px rgba(0,0,0,0.5);
    }

    #eq{
      width:100%;
      height:60px;
      background:#000;
      border-radius:6px;
      display:block;
      margin-bottom:4px; /* Ú†Ø³Ø¨ÛŒØ¯Ù‡ Ø¨Ù‡ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ */
    }

    .player-controls{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .player-title{
      flex:1;
      font-size:15px;
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
    }
    .vol{width:140px}

    @media(max-width:900px){
      .cols{flex-direction:column;margin-bottom:220px}
      #eq{height:45px;}
      .topbar{padding:10px}
      .title{font-size:18px}
    }
  </style>
</head>
<body>

  <div class="topbar">
    <div class="title">ğŸ§ Ø±Ø§Ø¯ÛŒÙˆ Ø¢Ù†Ù„Ø§ÛŒÙ†</div>

    <div class="controls" aria-hidden="false">
      <!-- Night/Day toggle -->
      <button id="modeBtn" class="mode-btn" title="ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª (Ø´Ø¨/Ø±ÙˆØ²)">
        <span id="modeIcon">ğŸŒ™</span>
        <span id="modeText">Ø¯Ø§Ø±Ú©</span>
      </button>

      <!-- color picker -->
      <div class="color-picker" id="colorPicker" aria-label="Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ù†Ú¯ ØªÙ…">
        <div class="color-swatch" data-color="#00ffa6" style="background:#00ffa6" title="Ø³Ø¨Ø²"></div>
        <div class="color-swatch" data-color="#00aaff" style="background:#00aaff" title="Ø¢Ø¨ÛŒ"></div>
        <div class="color-swatch" data-color="#ffcc00" style="background:#ffcc00" title="Ø²Ø±Ø¯"></div>
        <div class="color-swatch" data-color="#ff4444" style="background:#ff4444" title="Ù‚Ø±Ù…Ø²"></div>
        <div class="color-swatch" data-color="#c95bff" style="background:#c95bff" title="Ø¨Ù†ÙØ´"></div>
      </div>
    </div>
  </div>

  <div class="cols">
    <div class="col">
      <div class="category">ğŸ“Œ ØªØ±Ú©ÛŒ Ùˆ Ø¢Ø°Ø±ÛŒ</div>
      <div class="station-list" id="cat_tr"></div>
    </div>
    <div class="col">
      <div class="category">ğŸ“Œ ÙØ§Ø±Ø³ÛŒ</div>
      <div class="station-list" id="cat_fa"></div>
    </div>
  </div>

  <!-- Ù¾Ù„ÛŒØ± + Ø§Ú©ÙˆÙ„Ø§ÛŒØ²Ø± ÛŒÚ©Ø¬Ø§ -->
  <div class="player-box" role="region" aria-label="Ù¾Ù„ÛŒØ± Ùˆ Ø§Ú©ÙˆÙ„Ø§ÛŒØ²Ø±">
    <canvas id="eq" aria-hidden="true"></canvas>

    <div class="player-controls">
      <div class="player-title" id="nowPlaying">Ù‡ÛŒÚ† Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡</div>
      Ø­Ø¬Ù…:
      <input class="vol" id="volume" type="range" min="0" max="1" step="0.01" value="1" aria-label="Ø­Ø¬Ù… ØµØ¯Ø§">
      <button id="stopBtn" title="ØªÙˆÙ‚Ù Ù¾Ø®Ø´">â¹ ØªÙˆÙ‚Ù</button>
    </div>
  </div>

<script>
/* ==========================
   Stations list (unchanged)
   ========================== */
const stations = [
  { name:"Radio Shadi", url:"https://ice9.securenetsystems.net/SHADI", lang:"fa",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/NRIGBcOzqWFUZZ4dhVZ3bp6oKMftJTpniyrmgru7dZM/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvOGUyZDcwMjUtMmZhMC00MDU5LWFmNGMtMDg0ZjA1NmZjOTk4L2ltYWdlLz91PTE3MDE2OTc1OTEwMDA.webp" },

  { name:"Radio Avang Klap", url:"https://stream.zeno.fm/fpabqr8pd9zuv", lang:"fa",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/acnY7ntKys9h-2AhQvRWpVDUV0WY3Kh-Jfb8rkjNuH4/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvNTBmMmVlYjAtNzVkOC00YTllLTlkNWYtZjY1YjkwYjk3MDQ2L2ltYWdlLz91PTE3MzY4NDYwMzEwMDA.webp" },

  { name:"Radio Bamdad", url:"https://s2.cdn3.iranseda.ir/liveedge/radio-payam/playlist.m3u8", lang:"fa",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/RI7ZbLc36B1wt2hmlyMxSBwXpETbKBuvcd6coiCjGds/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvYWd4emZucGxibTh0YzNSaGRITnlNZ3NTQ2tGMWRHaERiR2xsYm5RWWdJQ1FvLTdyMGdvTUN4SU9VM1JoZEdsdmJsQnliMlpwYkdVWWdJQ1E0OGEwaUFnTW9nRUVlbVZ1YncvaW1hZ2UvP3U9MTY2MDgzMzA4MjAwMA.webp" },

  { name:"Radio Simorgh", url:"https://stream.zeno.fm/9svfnobkrxrvv", lang:"fa",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/eNYSMBmJNoW6_hcdkosiReSKOx7HHLAn7fP6Tso3DWc/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvMjAxZGE3MmItNWFhYy00OWU5LWEzN2YtM2IzYjZjZjZmZjQxL2ltYWdlLz91PTE3NjMxNjAxMzcwMDA.webp" },

  { name:"Radio Hamrah", url:"https://stream.zeno.fm/euutwhsru2wtv", lang:"fa",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/QXH8sr3xE8WGEbYBpaNlPpoAuEMKqcEoFDAZOS_fixI/rs:fill:256:256/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvYWd4emZucGxibTh0YzNSaGRITnlHd3NTRGxOMFlYUnBiMjVRY205bWFXeGxHSUNBZ0lEUDd0b0tES0lCQkhwbGJtOC9pbWFnZS8_dT0xNjcyMzAxMjY3MDAw.webp" },

  { name:"Radio Yar", url:"https://stream.zeno.fm/oyb5oh6ne3tuv", lang:"fa",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/kw4YYJRvsl-DswchOsWr3Vtz1MnLY8gfkPAf_FSMgyo/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvMWRjZmJjMzktYzM4NS00OTg3LWE5ZTQtYTFiMjE0NDAzZDg3L2ltYWdlLz91PTE3MjgzOTk2MzcwMDA.webp" },

  { name:"Radio Yar Plus", url:"https://stream.zeno.fm/2jwyo983y49vv", lang:"fa",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/7XCVsr_ZE1q3fpPcrCpQD1prYmMrjHoCWo2u7sHhGYU/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvZDYxZWM4ZjMtZTI1NC00ODBmLWE1NzAtNTZhNjYxYjY0ZTllL2ltYWdlLz91PTE3MzgxNTc4NTMwMDA.webp" },

  { name:"KIRN 670 AM", url:"https://stream.zeno.fm/wyth8w2r3heuv", lang:"fa",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/YJygcpY0wJ-ORl7yrs57txbWABe87n5INuAERhqfRXk/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvYWd4emZucGxibTh0YzNSaGRITnlNZ3NTQ2tGMWRHaERiR2xsYm5RWWdJQ0F0NWZQcWdvTUN4SU9VM1JoZEdsdmJsQnliMlpwYkdVWWdJQ0F3TW00akFvTW9nRUVlbVZ1YncvaW1hZ2UvP3U9MTY2MTI4MjY5MzAwMA.webp" },

  { name:"Radio Farsi London", url:"https://stream.zeno.fm/c3kkavhhzd0uv", lang:"fa",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/-YxtmG_1FTNyGCT_8g7soWRiEMvzx7HNLWvs57CcbIw/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvYWd4emZucGxibTh0YzNSaGRITnlNZ3NTQ2tGMWRHaERiR2xsYm5RWWdJREFqUHZXa0FnTUN4SU9VM1JoZEdsdmJsQnliMlpwYkdVWWdJRFEybzJKdVFvTW9nRUVlbVZ1YncvaW1hZ2UvP3U9MTY3ODA2MTQ1MDAwMA.webp" },

  /* ØªØ±Ú© / Ø¢Ø°Ø±ÛŒ */
  { name:"Arabesk Efsane FM", url:"https://stream.zeno.fm/x5n4sfyy9nhvv", lang:"tr",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/6PGFwWVgLll3f4INzxVqlwdjpOfStwE2wVTFu6GDrzw/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvYWd4emZucGxibTh0YzNSaGRITnlNZ3NTQ2tGMWRHaERiR2xsYm5RWWdJQ0l6YVR3dndnTUN4SU9VM1JoZEdsdmJsQnliMlpwYkdVWWdJQ0lfYi1XNFFrTW9nRUVlbVZ1YncvaW1hZ2UvP3U9MTY4NTE3MjE5NTAwMA.webp" },

  { name:"Radyo Nostalji", url:"https://stream.zeno.fm/q7zxyx2qsfhvv", lang:"tr",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/C40EP-w5lbCEjhD3OEXoLH0mqT4QAjoi3HcMlrdprM0/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvYWd4emZucGxibTh0YzNSaGRITnlNZ3NTQ2tGMWRHaERiR2xsYm5RWWdJQ0F4SkdkdkFzTUN4SU9VM1JoZEdsdmJsQnliMlpwYkdVWWdJQ0k2b3FmX3drTW9nRUVlbVZ1YncvaW1hZ2UvP3U9MTY4NjQ5NTUzMzAwMA.webp" },

  { name:"Radio Veten", url:"https://stream.zeno.fm/0kgkkzanmueuv", lang:"tr",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/8g8PctmUYIp-MsAb60n1yzr6UB2mIagYYh9OFcI8AO4/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvYWd4emZucGxibTh0YzNSaGRITnlNZ3NTQ2tGMWRHaERiR2xsYm5RWWdJREFwdENqdkFzTUN4SU9VM1JoZEdsdmJsQnliMlpwYkdVWWdJQ0FnSUR5aUFvTW9nRUVlbVZ1YncvaW1hZ2UvP3U9MTY3NDE5MDEyNzAwMA.webp" },

  { name:"Ä°znik FM", url:"https://stream.zeno.fm/4crdx4nukrnuv", lang:"tr",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/cbY5lyYrOd6Dy6Dor1DhLsqTzzfB4I8-0dwyooRgQa4/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvNzkwYTBjYjctYTMwMC00ODRjLWI2ZjItMTg5YmNjOWFjNmM1L2ltYWdlLz91PTE3NjI2ODg4ODIwMDA.webp" },

  { name:"NaxÃ§Ä±van Radiosu", url:"http://s33.myradiostream.com:12782/listen.mp3", lang:"tr",
    logo:"https://zeno.fm/_ipx/_/https://images.zeno.fm/qpsO_iNA8aGqsKrXHX0fUneE_f0gUl1kqYwilPn2HD4/rs:fill:288:288/g:ce:0:0/aHR0cHM6Ly9wcm94eS56ZW5vLmZtL2NvbnRlbnQvc3RhdGlvbnMvMjlmNzI0NTEtOWM2Ny00YzgxLWE0MTMtMWFlODJjYTM2ZWY4L2ltYWdlLz91PTE3MDE2OTY4MDYwMDA.webp" }
];

/* ===== create UI items ===== */
const cat_fa = document.getElementById('cat_fa');
const cat_tr = document.getElementById('cat_tr');
const nowPlaying = document.getElementById('nowPlaying');
const volume = document.getElementById('volume');
const stopBtn = document.getElementById('stopBtn');

const audio = new Audio();
audio.crossOrigin = "anonymous";
audio.preload = "none";
audio.volume = parseFloat(volume.value);

/* render station elements */
function makeStationElement(st){
  const el = document.createElement('div');
  el.className = 'station';

  const left = document.createElement('div'); left.className='left';
  const meta = document.createElement('div'); meta.className='meta';
  const title = document.createElement('div'); title.className='name'; title.textContent = st.name;
  meta.appendChild(title);

  if(st.logo){
    const img = document.createElement('img'); img.src = st.logo; img.alt = st.name;
    img.onerror = ()=>{ img.style.display='none' };
    left.appendChild(img);
  }
  left.appendChild(meta);

  const btn = document.createElement('button');
  btn.textContent = 'â–¶ Ù¾Ø®Ø´';
  btn.onclick = (e)=>{ e.stopPropagation(); handlePlay(st, btn); };

  el.appendChild(left);
  el.appendChild(btn);

  el.onclick = ()=> handlePlay(st, btn);
  return el;
}

stations.forEach(s=>{
  const node = makeStationElement(s);
  if(s.lang === 'fa') cat_fa.appendChild(node);
  else cat_tr.appendChild(node);
});

/* playback management */
let currentStation = null;
let currentButton = null;

function handlePlay(st, btn){
  if(currentStation && currentStation.url === st.url && !audio.paused){
    audio.pause();
    btn.textContent = 'â–¶ Ù¾Ø®Ø´';
    nowPlaying.textContent = 'Ù‡ÛŒÚ† Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡';
    return;
  }

  audio.src = st.url;
  audio.play().catch(err=>{
    console.warn('play failed:', err);
    alert('Ù¾Ø®Ø´ Ù†Ø§Ù…ÙˆÙÙ‚: Ù…Ø±ÙˆØ±Ú¯Ø± ÛŒØ§ Ù„ÛŒÙ†Ú© Ø§Ø³ØªØ±ÛŒÙ… Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±Ø¯. ÛŒÚ©Ø¨Ø§Ø± Ø±ÙˆÛŒ ØµÙØ­Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø§Ø¬Ø§Ø²Ù‡Ù” Ù¾Ø®Ø´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯ ÛŒØ§ Ù„ÛŒÙ†Ú© Ø±Ø§ Ú†Ú© Ú©Ù†.');
  });

  if(currentButton) currentButton.textContent = 'â–¶ Ù¾Ø®Ø´';
  btn.textContent = 'â¸ï¸ ØªÙˆÙ‚Ù';
  currentStation = st;
  currentButton = btn;
  nowPlaying.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´: ' + st.name;
}

/* controls */
volume.addEventListener('input', ()=>{ audio.volume = parseFloat(volume.value); });
stopBtn.addEventListener('click', ()=>{
  audio.pause();
  if(currentButton) currentButton.textContent = 'â–¶ Ù¾Ø®Ø´';
  nowPlaying.textContent = 'Ù‡ÛŒÚ† Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡';
});

/* ============ Theme & Accent color handling ============ */

const modeBtn = document.getElementById('modeBtn');
const modeIcon = document.getElementById('modeIcon');
const modeText = document.getElementById('modeText');
const swatches = Array.from(document.querySelectorAll('.color-swatch'));

const THEME_KEY = 'ra_theme_mode'; // 'dark' or 'light'
const ACCENT_KEY = 'ra_accent_color'; // hex

function applyTheme(theme){
  if(theme === 'light'){
    document.documentElement.style.setProperty('--bg', '#f5f6f7');
    document.documentElement.style.setProperty('--card', '#ffffff');
    document.documentElement.style.setProperty('--text', '#111827');
    document.documentElement.style.setProperty('--header', '#ffffff');
    document.documentElement.style.setProperty('--muted', 'rgba(0,0,0,0.06)');
    modeIcon.textContent = 'â˜€ï¸';
    modeText.textContent = 'Ù„Ø§ÛŒØª';
    modeBtn.classList.add('active');
  } else {
    document.documentElement.style.setProperty('--bg', '#121212');
    document.documentElement.style.setProperty('--card', '#1d1d1d');
    document.documentElement.style.setProperty('--text', '#eee');
    document.documentElement.style.setProperty('--header', '#151515');
    document.documentElement.style.setProperty('--muted', 'rgba(255,255,255,0.06)');
    modeIcon.textContent = 'ğŸŒ™';
    modeText.textContent = 'Ø¯Ø§Ø±Ú©';
    modeBtn.classList.remove('active');
  }
  localStorage.setItem(THEME_KEY, theme);
}

/* accent color setter */
function applyAccent(hex){
  document.documentElement.style.setProperty('--accent', hex);
  // also update any UI that depends on accent (button borders etc.)
  // highlight selected swatch
  swatches.forEach(s=>{
    if(s.dataset.color.toLowerCase() === hex.toLowerCase()) s.classList.add('selected');
    else s.classList.remove('selected');
  });
  localStorage.setItem(ACCENT_KEY, hex);
}

/* initial load */
(function initThemeAndAccent(){
  const savedTheme = localStorage.getItem(THEME_KEY) || 'dark';
  const savedAccent = localStorage.getItem(ACCENT_KEY) || getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#00ffa6';
  applyTheme(savedTheme);
  applyAccent(savedAccent);
})();

modeBtn.addEventListener('click', ()=>{
  const current = localStorage.getItem(THEME_KEY) || 'dark';
  const next = current === 'dark' ? 'light' : 'dark';
  applyTheme(next);
});

/* swatch clicks */
swatches.forEach(s=>{
  s.addEventListener('click', ()=>{
    const c = s.dataset.color;
    applyAccent(c);
  });
});

/* ============ Equalizer (WebAudio) ============ */
const eq = document.getElementById('eq');
const eqCtx = eq.getContext('2d');

function resizeEq(){
  const dpr = window.devicePixelRatio || 1;
  const cssH = parseInt(getComputedStyle(eq).height) || 60;
  eq.width = Math.floor(window.innerWidth * dpr);
  eq.height = cssH * dpr;
  eq.style.width = '100%';
  eq.style.height = cssH + 'px';
  eqCtx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener('resize', resizeEq);
resizeEq();

let audioCtx = null, analyser = null, srcNode = null;
function ensureAudioContext(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  srcNode = audioCtx.createMediaElementSource(audio);
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 256;
  srcNode.connect(analyser);
  analyser.connect(audioCtx.destination);
}

/* draw loop uses CSS --accent var */
function draw(){
  requestAnimationFrame(draw);

  if(!analyser){
    eqCtx.fillStyle = '#000';
    const w = eq.clientWidth, h = eq.clientHeight;
    eqCtx.fillRect(0,0,w,h);
    return;
  }

  const bufferLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);
  analyser.getByteFrequencyData(dataArray);

  const cssW = eq.clientWidth;
  const cssH = eq.clientHeight;
  eqCtx.fillStyle = '#000';
  eqCtx.fillRect(0,0,cssW,cssH);

  const barWidth = (cssW / bufferLength) * 2.2;
  let x = 0;

  // read accent color from CSS var each frame (so changes apply immediately)
  const accent = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#00ffa6';
  for(let i=0;i<bufferLength;i++){
    let raw = dataArray[i] / 255;
    let scaled = Math.min(raw, 1.0) * 0.7;
    let v = scaled * cssH;

    eqCtx.fillStyle = accent;
    eqCtx.fillRect(x, cssH - v, barWidth, v);

    x += barWidth + 1;
  }
}
draw();

/* create AudioContext on first user-initiated play */
audio.addEventListener('play', ()=>{
  try{ ensureAudioContext(); }catch(e){ console.warn(e) }
});
</script>
</body>
</html>
