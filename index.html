<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ø±Ø§Ø¯ÛŒÙˆ Ø¢Ù†Ù„Ø§ÛŒÙ†</title>
  <style>
    :root{
      --bg:#121212;
      --card:#1d1d1d;
      --accent:#00ffa6;
      --text:#eee;
      --header:#151515;
      --muted: rgba(255,255,255,0.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui, -apple-system, "Segoe UI", Roboto;
      direction:rtl;
      background:var(--bg);
      color:var(--text);
    }

    /* ===== Top Bar ===== */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 16px;
      background:var(--header);
      border-bottom:1px solid var(--muted);
      position:sticky;
      top:0;
      z-index:1500;
    }
    .title{font-size:20px; display:flex; align-items:center; gap:10px;}

    .controls{display:flex; align-items:center; gap:12px;}

    .mode-btn{
      background:transparent;
      border:1px solid var(--muted);
      color:var(--text);
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .mode-btn.active{border-color:var(--accent);}

    .color-picker{
      display:flex;
      gap:8px;
      padding:6px;
      border-radius:10px;
    }
    .color-swatch{
      width:22px;height:22px;
      border-radius:50%;
      cursor:pointer;
      border:2px solid rgba(255,255,255,0.07);
    }
    .color-swatch.selected{
      outline:2px solid #fff;
      transform:scale(1.1);
    }

    /* ===== Layout ===== */
    .cols{
      display:flex;
      gap:18px;
      padding:16px;
      max-width:1100px;
      margin: 12px auto 170px auto;
    }
    .col{flex:1;}
    .category{
      background:var(--card);
      padding:10px 14px;
      border-radius:8px;
      margin-bottom:10px;
      font-size:18px;
    }

    .station-list{display:flex; flex-direction:column; gap:10px;}
    .station{
      background:var(--card);
      border-radius:10px;
      display:flex;
      justify-content:space-between;
      padding:10px;
      cursor:pointer;
    }
    .station:hover{background:rgba(255,255,255,0.05);}
    .station img{width:44px;height:44px;border-radius:6px;}
    .station .left{display:flex;align-items:center;gap:12px;}
    .station .name{font-weight:600;}
    .station button{
      background:var(--accent);
      border:none;
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      color:#000;
    }

    /* ===== Player ===== */
    .player-box{
      position:fixed;
      bottom:0; left:0; right:0;
      padding:12px;
      background:var(--card);
      border-top:3px solid var(--accent);
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index:2000;
      box-shadow:0 -6px 20px rgba(0,0,0,0.5);
    }

    #eq{
      width:100%;
      height:60px;
      background:#000;
      border-radius:6px;
    }

    .player-controls{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .player-title{
      flex:1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    @media(max-width:900px){
      .cols{flex-direction:column; margin-bottom:230px;}
      #eq{height:45px;}
    }
  </style>
</head>
<body>

  <!-- ============================= -->
  <!--           TOP BAR             -->
  <!-- ============================= -->
  <div class="topbar">
    <div class="title">ğŸ§ Ø±Ø§Ø¯ÛŒÙˆ Ø¢Ù†Ù„Ø§ÛŒÙ†</div>

    <div class="controls">
      <button id="modeBtn" class="mode-btn">
        <span id="modeIcon">ğŸŒ™</span>
        <span id="modeText">Ø¯Ø§Ø±Ú©</span>
      </button>

      <div class="color-picker" id="colorPicker">
        <div class="color-swatch" data-color="#00ffa6" style="background:#00ffa6"></div>
        <div class="color-swatch" data-color="#00aaff" style="background:#00aaff"></div>
        <div class="color-swatch" data-color="#ffcc00" style="background:#ffcc00"></div>
        <div class="color-swatch" data-color="#ff4444" style="background:#ff4444"></div>
        <div class="color-swatch" data-color="#c95bff" style="background:#c95bff"></div>
      </div>
    </div>
  </div>

  <!-- ============================= -->
  <!--           CHANNELS            -->
  <!-- ============================= -->
  <div class="cols">
    <div class="col">
      <div class="category">ğŸ“Œ ØªØ±Ú©ÛŒ Ùˆ Ø¢Ø°Ø±ÛŒ</div>
      <div class="station-list" id="cat_tr"></div>
    </div>

    <div class="col">
      <div class="category">ğŸ“Œ ÙØ§Ø±Ø³ÛŒ</div>
      <div class="station-list" id="cat_fa"></div>
    </div>
  </div>

  <!-- ============================= -->
  <!--            PLAYER             -->
  <!-- ============================= -->
  <div class="player-box">
    <canvas id="eq"></canvas>

    <div class="player-controls">
      <div class="player-title" id="nowPlaying">Ù‡ÛŒÚ† Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡</div>

      Ø­Ø¬Ù…:
      <input class="vol" id="volume" type="range" min="0" max="1" step="0.01" value="1">

      <button id="stopBtn">â¹ ØªÙˆÙ‚Ù</button>
    </div>
  </div>

<script>
/* ==============================
   Stations List (unchanged)
   ============================== */
const stations = [
  {name:"Radio Shadi", url:"https://ice9.securenetsystems.net/SHADI", lang:"fa",
   logo:"https://images.zeno.fm/NRIGBcOzqWFUZZ4dhVZ3bp6oKMftJTpniyrmgru7dZM"},
  {name:"Radio Avang Klap", url:"https://stream.zeno.fm/fpabqr8pd9zuv", lang:"fa",
   logo:"https://images.zeno.fm/acnY7ntKys9h-2AhQvRWpVDUV0WY3Kh-Jfb8rkjNuH4"},
  {name:"Radio Bamdad", url:"https://stream.zeno.fm/16gxgv7ch5zuv", lang:"fa",
   logo:"https://images.zeno.fm/RI7ZbLc36B1wt2hmlyMxSBwXpETbKBuvcd6coiCjGds"},
  {name:"Radio Simorgh", url:"https://stream.zeno.fm/9svfnobkrxrvv", lang:"fa",
   logo:"https://images.zeno.fm/eNYSMBmJNoW6_hcdkosiReSKOx7HHLAn7fP6Tso3DWc"},
  {name:"Radio Hamrah", url:"https://stream.zeno.fm/euutwhsru2wtv", lang:"fa",
   logo:"https://images.zeno.fm/QXH8sr3xE8WGEbYBpaNlPpoAuEMKqcEoFDAZOS_fixI"},
  {name:"Radio Yar", url:"https://stream.zeno.fm/oyb5oh6ne3tuv", lang:"fa",
   logo:"https://images.zeno.fm/kw4YYJRvsl-DswchOsWr3Vtz1MnLY8gfkPAf_FSMgyo"},
  {name:"Radio Yar Plus", url:"https://stream.zeno.fm/2jwyo983y49vv", lang:"fa",
   logo:"https://images.zeno.fm/7XCVsr_ZE1q3fpPcrCpQD1prYmMrjHoCWo2u7sHhGYU"},
  {name:"KIRN 670 AM", url:"https://stream.zeno.fm/wyth8w2r3heuv", lang:"fa",
   logo:"https://images.zeno.fm/YJygcpY0wJ-ORl7yrs57txbWABe87n5INuAERhqfRXk"},
  {name:"Radio Farsi London", url:"https://stream.zeno.fm/c3kkavhhzd0uv", lang:"fa",
   logo:"https://images.zeno.fm/-YxtmG_1FTNyGCT_8g7soWRiEMvzx7HNLWvs57CcbIw"},

  /* Turkish */
  {name:"Arabesk Efsane FM", url:"https://stream.zeno.fm/x5n4sfyy9nhvv", lang:"tr",
   logo:"https://images.zeno.fm/6PGFwWVgLll3f4INzxVqlwdjpOfStwE2wVTFu6GDrzw"},
  {name:"Radyo Nostalji", url:"https://stream.zeno.fm/q7zxyx2qsfhvv", lang:"tr",
   logo:"https://images.zeno.fm/C40EP-w5lbCEjhD3OEXoLH0mqT4QAjoi3HcMlrdprM0"},
  {name:"Radio Veten", url:"https://stream.zeno.fm/0kgkkzanmueuv", lang:"tr",
   logo:"https://images.zeno.fm/8g8PctmUYIp-MsAb60n1yzr6UB2mIagYYh9OFcI8AO4"},
  {name:"Ä°znik FM", url:"https://stream.zeno.fm/4crdx4nukrnuv", lang:"tr",
   logo:"https://images.zeno.fm/cbY5lyYrOd6Dy6Dor1DhLsqTzzfB4I8-0dwyooRgQa4"},
  {name:"NaxÃ§Ä±van Radiosu", url:"http://s33.myradiostream.com:12782/listen.mp3", lang:"tr",
   logo:"https://images.zeno.fm/qpsO_iNA8aGqsKrXHX0fUneE_f0gUl1kqYwilPn2HD4"}
];

/* Build lists */
const cat_fa = document.getElementById('cat_fa');
const cat_tr = document.getElementById('cat_tr');

function makeEl(st){
  const box = document.createElement('div');
  box.className="station";

  const L = document.createElement('div');
  L.className="left";

  const img = document.createElement('img');
  img.src = st.logo;
  img.onerror = ()=>img.style.display="none";

  const meta = document.createElement('div');
  const name = document.createElement('div');
  name.className="name";
  name.textContent = st.name;

  meta.appendChild(name);
  L.appendChild(img);
  L.appendChild(meta);

  const btn = document.createElement('button');
  btn.textContent="â–¶ Ù¾Ø®Ø´";

  box.appendChild(L);
  box.appendChild(btn);

  box.onclick = ()=> play(st, btn);
  btn.onclick = e=>{ e.stopPropagation(); play(st, btn); };

  return box;
}

stations.forEach(s=>{
  const el = makeEl(s);
  if(s.lang==="fa") cat_fa.appendChild(el);
  else cat_tr.appendChild(el);
});

/* ===== Audio ===== */
const audio = new Audio();
audio.crossOrigin="anonymous";
audio.volume=1;
let currentBtn=null;
let currentStation=null;

const nowPlaying = document.getElementById('nowPlaying');
const volume = document.getElementById('volume');
const stopBtn = document.getElementById('stopBtn');

function play(st, btn){
  if(currentStation && currentStation.url===st.url && !audio.paused){
    audio.pause();
    btn.textContent="â–¶ Ù¾Ø®Ø´";
    nowPlaying.textContent="Ù‡ÛŒÚ† Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡";
    return;
  }

  audio.src = st.url;
  audio.play();

  if(currentBtn) currentBtn.textContent="â–¶ Ù¾Ø®Ø´";
  btn.textContent="â¸ ØªÙˆÙ‚Ù";

  currentBtn = btn;
  currentStation = st;
  nowPlaying.textContent="Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´: "+st.name;
}

volume.oninput = ()=> audio.volume = volume.value;
stopBtn.onclick = ()=>{
  audio.pause();
  if(currentBtn) currentBtn.textContent="â–¶ Ù¾Ø®Ø´";
  nowPlaying.textContent="Ù‡ÛŒÚ† Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡";
};

/* ===== Theme ===== */
const modeBtn = document.getElementById('modeBtn');
const modeIcon = document.getElementById('modeIcon');
const modeText = document.getElementById('modeText');
const THEME_KEY="theme";

function applyLight(){
  document.documentElement.style.setProperty('--bg','#e5e7eb');
  document.documentElement.style.setProperty('--card','#f3f4f6');
  document.documentElement.style.setProperty('--text','#1f2937');
  document.documentElement.style.setProperty('--header','#f3f4f6');
  document.documentElement.style.setProperty('--muted','rgba(0,0,0,0.08)');
  modeIcon.textContent="â˜€ï¸";
  modeText.textContent="Ù„Ø§ÛŒØª";
  modeBtn.classList.add("active");
  localStorage.setItem(THEME_KEY,"light");
}
function applyDark(){
  document.documentElement.style.setProperty('--bg','#121212');
  document.documentElement.style.setProperty('--card','#1d1d1d');
  document.documentElement.style.setProperty('--text','#eee');
  document.documentElement.style.setProperty('--header','#151515');
  document.documentElement.style.setProperty('--muted','rgba(255,255,255,0.06)');
  modeIcon.textContent="ğŸŒ™";
  modeText.textContent="Ø¯Ø§Ø±Ú©";
  modeBtn.classList.remove("active");
  localStorage.setItem(THEME_KEY,"dark");
}

if(localStorage.getItem(THEME_KEY)==="light") applyLight();
else applyDark();

modeBtn.onclick = ()=>{
  if(localStorage.getItem(THEME_KEY)==="light") applyDark();
  else applyLight();
};

/* ===== Accent Colors ===== */
const swatches = [...document.querySelectorAll('.color-swatch')];
const ACCENT_KEY="accent";
function applyAccent(c){
  document.documentElement.style.setProperty('--accent', c);
  swatches.forEach(s=>s.classList.remove("selected"));
  swatches.find(s=>s.dataset.color===c).classList.add("selected");
  localStorage.setItem(ACCENT_KEY,c);
}
const savedAccent = localStorage.getItem(ACCENT_KEY) || "#00ffa6";
applyAccent(savedAccent);

swatches.forEach(s=>{
  s.onclick = ()=> applyAccent(s.dataset.color);
});

/* ===== Equalizer ===== */
const eq=document.getElementById('eq');
const ctx=eq.getContext('2d');

function resize(){
  const dpr=window.devicePixelRatio||1;
  const h=parseInt(getComputedStyle(eq).height);
  eq.width = eq.clientWidth*dpr;
  eq.height = h*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener('resize',resize);
resize();

let AC=null, AN=null, SRC=null;

function initAC(){
  if(AC) return;
  AC = new AudioContext();
  SRC = AC.createMediaElementSource(audio);
  AN = AC.createAnalyser();
  AN.fftSize = 256;
  AN.smoothingTimeConstant = 0.55;
  SRC.connect(AN);
  AN.connect(AC.destination);
}

audio.addEventListener("play", ()=> initAC());

function draw(){
  requestAnimationFrame(draw);

  if(!AN){
    ctx.fillStyle="#000";
    ctx.fillRect(0,0,eq.clientWidth,eq.clientHeight);
    return;
  }

  const buf=AN.frequencyBinCount;
  const arr=new Uint8Array(buf);
  AN.getByteFrequencyData(arr);

  const usable = Math.floor(buf*0.80); // skip last 20%

  const w=eq.clientWidth;
  const h=eq.clientHeight;
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,w,h);

  const accent=getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();

  const barW=(w/usable)*1.8;
  let x=0;

  for(let i=0;i<usable;i++){
    const v = (arr[i]/255)*h;
    ctx.fillStyle=accent;
    ctx.fillRect(x,h-v,barW,v);
    x+=barW+1;
  }
}
draw();
</script>
</body>
</html>
